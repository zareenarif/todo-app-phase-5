# =============================================================================
# Todo AI Chatbot â€” Helm Values
# All deployment configuration is driven from this file.
# Secrets are managed externally via kubectl create secret.
# =============================================================================

# -- Frontend (Next.js ChatKit UI) ------------------------------------------
frontend:
  replicaCount: 1

  image:
    repository: todo-frontend
    tag: "1.0.0"
    pullPolicy: Never    # Local images loaded via minikube image load

  service:
    type: NodePort
    port: 3000

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

  livenessProbe:
    tcpSocket:
      port: 3000
    initialDelaySeconds: 20
    periodSeconds: 10
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /
      port: 3000
    initialDelaySeconds: 25
    periodSeconds: 10
    failureThreshold: 3

# -- Backend (FastAPI + MCP + Agents SDK) ------------------------------------
backend:
  replicaCount: 1

  image:
    repository: todo-backend
    tag: "1.0.0"
    pullPolicy: Never    # Local images loaded via minikube image load

  service:
    type: ClusterIP
    port: 8000

  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi

  livenessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 15
    periodSeconds: 10
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 10
    periodSeconds: 5
    failureThreshold: 3

# -- Application Config (non-sensitive, stored in ConfigMap) -----------------
config:
  corsOrigins: "http://localhost:3000"
  debug: "False"
  backendPort: "8000"
  frontendPort: "3000"
  llmProvider: "groq"
  groqModel: "llama-3.3-70b-versatile"

# -- Secrets (reference to externally created K8s Secret) --------------------
secrets:
  # Secret MUST be created before helm install:
  #   kubectl create secret generic todo-secrets \
  #     --namespace todo-chatbot \
  #     --from-literal=DATABASE_URL='...' \
  #     --from-literal=BETTER_AUTH_SECRET='...' \
  #     --from-literal=OPENAI_API_KEY='...' \
  #     --from-literal=GROQ_API_KEY='...'
  existingSecret: todo-secrets

# -- Kafka (Event Backbone) ---------------------------------------------------
# Override in values-local.yaml, values-redpanda-local.yaml, or values-production.yaml
kafka:
  enabled: false                # Set true in environment-specific values
  provider: "strimzi"           # "strimzi" | "redpanda" | "external"
  namespace: ""                 # Defaults to Release.Namespace
  brokers: "localhost:9092"
  version: "3.7.0"
  replicas: 1
  apiVersion: "2.0.0"

  auth:
    enabled: false
    type: "password"
    username: ""
    mechanism: "SCRAM-SHA-256"
    secretName: "kafka-credentials"
    secretKey: "password"
  tls:
    enabled: false

  storage:
    size: "5Gi"
    class: ""

  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "500m"

  zookeeper:
    replicas: 1
    storage:
      size: "2Gi"
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "250m"

  redpanda:
    cpuCores: "500m"

  topics:
    taskEvents:
      partitions: 3
      replicas: 1
      retentionMs: "604800000"    # 7 days
    taskUpdates:
      partitions: 3
      replicas: 1
      retentionMs: "604800000"
    reminders:
      partitions: 1
      replicas: 1
      retentionMs: "259200000"    # 3 days

# -- Dapr (Event-Driven Middleware) --------------------------------------------
dapr:
  enabled: false                # Set true in environment-specific values
  appId: "todo-backend"
  appPort: 8000

  pubsub:
    name: "pubsub-kafka"
    consumerGroup: "todo-backend-group"
    clientID: "todo-backend"
    maxRetryCount: "3"
    retryInterval: "1000ms"
    maxMessageBytes: "1048576"
    requiredAcks: "all"

  resiliency:
    retry:
      maxRetries: 3
      initialDuration: "1s"
      maxInterval: "10s"
    circuitBreaker:
      maxRequests: 1
      interval: "30s"
      timeout: "60s"
      tripThreshold: 5
    timeout: "10s"

# -- Image Pull Secrets (for private registries, production only) --------------
imagePullSecrets: []

# -- Ingress (disabled by default, enable in production values) ----------------
ingress:
  enabled: false
