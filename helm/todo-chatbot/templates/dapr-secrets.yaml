{{- if .Values.dapr.enabled }}
# =============================================================================
# Dapr Secrets Store Component — Kubernetes Secrets
#
# Allows the backend to retrieve secrets via Dapr sidecar API instead of
# directly mounting Kubernetes Secrets as env vars (optional pattern).
#
# Application code accesses secrets via:
#   GET http://localhost:3500/v1.0/secrets/secrets-kubernetes/<secret-name>/<key>
#
# In practice, the todo-chatbot uses envFrom (K8s Secret → env vars) as the
# primary secret delivery mechanism. This Dapr component provides an
# alternative path for runtime secret retrieval without pod restarts.
# =============================================================================
apiVersion: dapr.io/v1alpha1
kind: Component
metadata:
  name: {{ .Values.dapr.secrets.name | default "secrets-kubernetes" }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "todo-chatbot.labels" . | nindent 4 }}
    component: dapr-secrets
spec:
  type: secretstores.kubernetes
  version: v1
  metadata: []

  # Scope to backend app only — frontend does not need secret access via Dapr
  scopes:
    - {{ .Values.dapr.appId | default "todo-backend" }}
{{- end }}
